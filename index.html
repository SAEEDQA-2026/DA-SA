<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ</title>
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3209/3209265.png">
    
    <style>
        :root {
            --primary: #0f172a; --accent: #e11d48; --gold: #f59e0b; --success: #10b981; --bg: #f8fafc;
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: env(safe-area-inset-top) 15px 20px 15px; color: var(--primary); }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„ØªØ·Ø¨ÙŠÙ‚) */
        .app-header { background: linear-gradient(135deg, var(--primary), #1e293b); color: white; border-radius: 0 0 30px 30px; margin: -15px -15px 20px -15px; padding: 40px 20px 25px 20px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .nav-row { display: flex; justify-content: space-between; align-items: center; }
        .nav-btn { background: rgba(255,255,255,0.15); border: none; color: white; width: 50px; height: 50px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .nav-btn:active { background: var(--gold); }
        
        .main-day { font-size: 3.5rem; font-weight: 900; margin: 0; }
        .main-clock { font-size: 2.2rem; font-family: monospace; color: var(--gold); margin: 5px 0; font-weight: bold; }
        .date-chip { background: rgba(255,255,255,0.1); padding: 8px 18px; border-radius: 50px; font-size: 1rem; border: 1px solid rgba(255,255,255,0.1); margin: 5px; display: inline-block; }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        #dutyAlert { display: none; background: var(--accent); color: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center; font-weight: bold; box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3); border: 2px solid white; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from {transform: translateY(-20px); opacity:0;} to {transform: translateY(0); opacity:1;} }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-right: 10px solid var(--primary); }
        .card.samar { border-right-color: var(--gold); }
        .card h3 { margin: 0 0 12px 0; font-size: 0.9rem; color: #64748b; border-bottom: 1px solid #f1f5f9; padding-bottom: 6px; }
        .card .val { font-size: 1.6rem; font-weight: bold; color: var(--primary); }

        /* ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØªØ±Ø§Øª */
        .shifts { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .s-box { background: #f1f5f9; padding: 12px; border-radius: 15px; border: 1px solid #e2e8f0; }
        .s-box h4 { margin: 0 0 8px 0; font-size: 0.85rem; color: var(--gold); display: flex; align-items: center; gap: 5px; }
        .names { font-size: 0.9rem; line-height: 1.6; color: #334155; white-space: pre-line; font-weight: 500; }

        /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .action-bar { background: white; border-radius: 20px; padding: 15px; margin-bottom: 20px; display: flex; gap: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; font-size: 1rem; outline: none; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
        details { background: white; border-radius: 20px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        summary { padding: 18px; font-weight: bold; cursor: pointer; background: var(--gold); color: white; list-style: none; text-align: center; font-size: 1.1rem; }
        .schedule-list { padding: 10px; }
        .s-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px dashed #e2e8f0; }

        #configPanel { display: none; background: white; border-radius: 20px; padding: 20px; margin-top: 10px; border: 2px solid #e2e8f0; }
        textarea { width: 100%; height: 80px; margin-bottom: 15px; border-radius: 10px; padding: 10px; border: 1px solid #cbd5e1; font-family: inherit; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="dutyAlert">âš ï¸ Ø§Ù„ÙŠÙˆÙ… Ø§Ø³ØªÙ„Ø§Ù…Ùƒ ÙŠØ§ "Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ"</div>

    <header class="app-header">
        <div class="nav-row">
            <button class="nav-btn" onclick="nav(-1)">â®</button>
            <h1 id="txtDay" class="main-day">Ø§Ù„Ø³Ø¨Øª</h1>
            <button class="nav-btn" onclick="nav(1)">â¯</button>
        </div>
        <div id="txtTime" class="main-clock">00:00:00</div>
        <div class="date-row">
            <span id="txtHijri" class="date-chip">-- Ø´Ø¹Ø¨Ø§Ù† 1447</span>
            <span id="txtGregorian" class="date-chip">-- / -- / 2026</span>
        </div>
    </header>

    <div class="card samar">
        <h3>ğŸ‘¤ Ø§Ù„Ø³Ø§Ù…Ø± Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</h3>
        <span id="resSamar" class="val">--</span>
    </div>

    <div class="card">
        <h3>ğŸ‘¥ <span id="resTeamTitle">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</span></h3>
        <div class="shifts">
            <div class="s-box">
                <h4>â˜€ï¸ Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</h4>
                <div id="resMorning" class="names">--</div>
            </div>
            <div class="s-box">
                <h4>ğŸŒ™ Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</h4>
                <div id="resEvening" class="names">--</div>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <input type="text" id="nameInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ..." onkeyup="if(event.keyCode===13) search()">
        <button class="btn-main" onclick="search()">Ø¨Ø­Ø«</button>
    </div>
    <div id="searchRes" style="display:none; background:#fff9db; padding:15px; border-radius:20px; margin-bottom:20px; border:1px solid #ffe066;"></div>

    <details>
        <summary>ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ Ø§Ø³ØªÙ„Ø§Ù…Ø§Øª Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</summary>
        <div id="saeedSchedule" class="schedule-list"></div>
    </details>

    <button class="btn-main" style="background:#64748b; width:100%; margin-bottom:30px;" onclick="toggleConfig()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ù‚ ÙˆØ§Ù„Ø£Ø³Ù…Ø§Ø¡</button>

    <div id="configPanel">
        <h3 style="color:var(--primary)">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <label>Ø§Ù„Ø³Ù…Ø§Ø± (Ø§ÙØµÙ„ Ø¨Ù€ -):</label>
        <textarea id="cfgSamar"></textarea>
        <p style="font-size:0.75rem; color:red">* Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ø§Ù…Ø© | Ù„ÙØµÙ„ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„ÙØ±Ù‚.</p>
        <label>Ø§Ù„ÙØ±Ù‚Ø© 1:</label><textarea id="cfgT1"></textarea>
        <label>Ø§Ù„ÙØ±Ù‚Ø© 2:</label><textarea id="cfgT2"></textarea>
        <label>Ø§Ù„ÙØ±Ù‚Ø© 3:</label><textarea id="cfgT3"></textarea>
        <button class="btn-main" style="background:var(--success); width:100%" onclick="saveData()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>

<script>
    // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ§Øª ---
    // Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯: Ø§Ù„Ø³Ø¨Øª 31 ÙŠÙ†Ø§ÙŠØ± 2026 = 12 Ø´Ø¹Ø¨Ø§Ù† 1447 Ù‡Ù€
    const REF_DATE = new Date(2026, 0, 31);
    const REF_HIJRI = { d: 12, m: 8, y: 1447 };

    let currentView = new Date();
    currentView.setHours(0,0,0,0);

    let sammar = JSON.parse(localStorage.getItem('sa_sammar_v3')) || ["Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ", "ÙŠØ­ÙŠ Ù‚Ø¹ÙˆØ§Ù†", "Ø­Ø³Ù† Ø³Ø¹ÙŠØ¯", "Ù…Ù‡Ø¯ÙŠ Ù‡Ø§Ø¯ÙŠ"];
    let teams = JSON.parse(localStorage.getItem('sa_teams_v3')) || [
        { n: "Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", m: "Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¬ÙˆÙŠØ± Ø§Ù„Ù„Ù‡- Ø³Ø¹ÙŠØ¯ Ø¹ÙˆØ¶\nØ¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø³Ø¹ÙˆØ¯- Ø³Ø¹Ø¯ Ø³Ø¹ÙŠØ¯ | Ù…Ù„ÙÙŠ Ù…Ø­Ù…Ø¯ - Ù…Ø­Ù…Ø¯ Ø±Ø§Ù‚Ø¹\nÙ…Ø§Ù†Ø¹ Ø¹Ù„ÙŠ - Ù…ÙÙ„Ø­ Ù…Ø­Ù…Ø¯" },
        { n: "Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", m: "Ø­ÙŠØ§Ù† ÙŠØ­ÙŠÙ‰\nØ­Ø§Ù…Ø¯ Ø³Ø¹ÙŠØ¯ - Ù…Ø¨Ø§Ø±Ùƒ Ø¹ÙˆØ¶ | Ù…Ø¨Ø·ÙŠ Ø³Ø¹ÙŠØ¯ - Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¹Ø¯\nÙ…Ø³Ø±Ø¹ Ø¸Ø§ÙØ± - Ø®Ø§Ø·Ø± Ù…Ø­Ù…Ø¯" },
        { n: "Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", m: "Ø£Ø­Ù…Ø¯ Ø§Ù„Ù‡Ø§Ø¬Ø±ÙŠ- Ø¹Ù„ÙŠ ÙØ§ÙŠØ²\nØ¬Ø§Ø¨Ø± ÙŠØ­ÙŠÙ‰ - Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ø´Ø¨Ø§Ø¨ | Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø§Ù‡Ù„ - Ø°ÙŠØ¨ Ù…Ø­Ù…Ø¯\nØ¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ù‡Ø¯ÙŠ" }
    ];

    function render() {
        let diff = Math.floor((currentView - REF_DATE) / 86400000);

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù…Ø§Ø± (4 Ø£ÙŠØ§Ù…)
        let sIdx = ((diff % 4) + 4) % 4;
        document.getElementById('resSamar').innerText = sammar[sIdx];

        // ØªÙ†Ø¨ÙŠÙ‡ Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ
        const isToday = currentView.toDateString() === new Date().toDateString();
        document.getElementById('dutyAlert').style.display = (isToday && sammar[sIdx] === "Ø³Ø¹ÙŠØ¯ Ø¹Ù„ÙŠ") ? "block" : "none";

        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ (3 Ø£ÙŠØ§Ù…)
        let tIdx = ((diff % 3) + 3) % 3;
        document.getElementById('resTeamTitle').innerText = teams[tIdx].n;
        let parts = teams[tIdx].m.split('|');
        document.getElementById('resMorning').innerText = parts[0]?.trim() || "-";
        document.getElementById('resEvening').innerText = parts[1]?.trim() || "-";

        // Ø§Ù„ØªØ§Ø±ÙŠØ®
        document.getElementById('txtDay').innerText = currentView.toLocaleDateString('ar-SA', {weekday:'long'});
        document.getElementById('txtGregorian').innerText = currentView.toLocaleDateString('en-GB');
        document.getElementById('txtHijri').innerText = calculateHijri(diff);

        buildSaeedSchedule();
    }

    function calculateHijri(diff) {
        let d = REF_HIJRI.d + diff;
        let m = REF_HIJRI.m; let y = REF_HIJRI.y;
        while (d > 30) { d -= 30; m++; }
        while (d < 1) { d += 30; m--; }
        if (m > 12) { m = 1; y++; } if (m < 1) { m = 12; y--; }
        const months = ["", "Ù…Ø­Ø±Ù…", "ØµÙØ±", "Ø±Ø¨ÙŠØ¹ Ø£ÙˆÙ„", "Ø±Ø¨ÙŠØ¹ Ø«Ø§Ù†ÙŠ", "Ø¬Ù…Ø§Ø¯Ù‰ Ø£ÙˆÙ„", "Ø¬Ù…Ø§Ø¯Ù‰ Ø«Ø§Ù†ÙŠ", "Ø±Ø¬Ø¨", "Ø´Ø¹Ø¨Ø§Ù†", "Ø±Ù…Ø¶Ø§Ù†", "Ø´ÙˆØ§Ù„", "Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©", "Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©"];
        return `${d} ${months[m]} ${y} Ù‡Ù€`;
    }

    function nav(offset) {
        currentView.setDate(currentView.getDate() + offset);
        render();
    }

    function search() {
        let q = document.getElementById('nameInput').value.trim();
        if(!q) return;
        let res = document.getElementById('searchRes');
        res.style.display = "block";
        res.innerHTML = `<b>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† (${q}):</b><br>`;
        let found = 0;
        let start = new Date(); start.setHours(0,0,0,0);
        for(let i=-15; i<45; i++) {
            let d = new Date(start); d.setDate(start.getDate() + i);
            let diff = Math.floor((d - REF_DATE) / 86400000);
            let sIdx = ((diff % 4) + 4) % 4;
            let tIdx = ((diff % 3) + 3) % 3;
            if(sammar[sIdx].includes(q) || teams[tIdx].m.includes(q)) {
                res.innerHTML += `<div style="font-size:0.85rem; padding:5px 0; border-bottom:1px solid #eee;">
                    ${d.toLocaleDateString('ar-SA', {weekday:'short', day:'numeric', month:'short'})}: 
                    ${sammar[sIdx].includes(q) ? 'Ø³Ø§Ù…Ø± Ù…Ø³ØªÙ„Ù…' : 'ÙØ±Ù‚Ø© Ù…Ø³ØªÙ„Ù…Ø©'}
                </div>`;
                found++;
            }
        }
        if(!found) res.innerHTML += "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø³ØªÙ„Ø§Ù…Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….";
    }

    function buildSaeedSchedule() {
        const div = document.getElementById('saeedSchedule');
        div.innerHTML = "";
        let today = new Date(); today.setHours(0,0,0,0);
        for(let i=0; i<30; i++) {
            let d = new Date(today); d.setDate(today.getDate() + i);
            let diff = Math.floor((d - REF_DATE) / 86400000);
            if(diff % 4 === 0) {
                div.innerHTML += `<div class="s-item">
                    <span>${d.toLocaleDateString('ar-SA', {weekday:'long', day:'numeric', month:'short'})}</span>
                    <span style="color:var(--success); font-weight:bold;">Ø§Ø³ØªÙ„Ø§Ù… âœ…</span>
                </div>`;
            }
        }
    }

    function toggleConfig() {
        let p = document.getElementById('configPanel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        document.getElementById('cfgSamar').value = sammar.join(' - ');
        document.getElementById('cfgT1').value = teams[0].m;
        document.getElementById('cfgT2').value = teams[1].m;
        document.getElementById('cfgT3').value = teams[2].m;
    }

    function saveData() {
        sammar = document.getElementById('cfgSamar').value.split('-').map(s => s.trim());
        teams[0].m = document.getElementById('cfgT1').value;
        teams[1].m = document.getElementById('cfgT2').value;
        teams[2].m = document.getElementById('cfgT3').value;
        localStorage.setItem('sa_sammar_v3', JSON.stringify(sammar));
        localStorage.setItem('sa_teams_v3', JSON.stringify(teams));
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
        location.reload();
    }

    setInterval(() => {
        document.getElementById('txtTime').innerText = new Date().toLocaleTimeString('en-GB', {hour12:false});
    }, 1000);

    render();
</script>
</body>
</html>